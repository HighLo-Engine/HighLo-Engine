name: Windows Build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

env:
  # Path to the solution file relative to the root of the project.
  SOLUTION_FILE_PATH: .
  
  STRING_UNIT_TEST_FILE_PATH: .\tests\StringTest\
  ENCRYPTION_UNIT_TEST_FILE_PATH: .\tests\EncryptionTest\
  LIST_UNIT_TEST_FILE_PATH: .\tests\ListTest\
  HASHMAP_UNIT_TEST_FILE_PATH: .\tests\HashmapTest\
  VECTOR_UNIT_TEST_FILE_PATH: .\tests\VectorTest\
  QUEUE_UNIT_TEST_FILE_PATH: .\tests\QueueTest\
  STACK_UNIT_TEST_FILE_PATH: .\tests\StackTest\
  ECS_UNIT_TEST_FILE_PATH: .\tests\ECSTest\

  # Configuration type to build.
  # You can convert this to a build matrix if you need coverage of multiple configuration types.
  # https://docs.github.com/actions/learn-github-actions/managing-complex-workflows#using-a-build-matrix
  BUILD_CONFIGURATION: Release  
  BUILD_PLATFORM: x64

jobs:
  build:
    runs-on: windows-latest
    steps:
        - uses: actions/checkout@v2
          with:
            lfs: true
            submodules: true

        - name: Add MSBuild to PATH
          uses: microsoft/setup-msbuild@v1.0.2
          
        - name: Generate Engine
          run: |
            cd scripts
            .\GenerateEngine-Windows.bat
            cd ..

        - name: Build Engine
          working-directory: ${{env.GITHUB_WORKSPACE}}
          # Add additional options to the MSBuild command line here (like platform or verbosity level).
          # See https://docs.microsoft.com/visualstudio/msbuild/msbuild-command-line-reference
          run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} /p:Platform=${{env.BUILD_PLATFORM}} /p:PostBuildEventUseInBuild=false ${{env.SOLUTION_FILE_PATH}}
          
        - name: Generate Unit-Tests
          run: |
            cd scripts
            .\GenerateUnitTests.bat
            cd ..
          
        - name: Build String Unit Test
          working-directory: ${{env.GITHUB_WORKSPACE}}
          run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} /p:Platform=${{env.BUILD_PLATFORM}} /p:PostBuildEventUseInBuild=false ${{env.STRING_UNIT_TEST_FILE_PATH}}

        - name: Build Encryption Unit Test
          working-directory: ${{env.GITHUB_WORKSPACE}}
          run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} /p:Platform=${{env.BUILD_PLATFORM}} /p:PostBuildEventUseInBuild=false ${{env.ENCRYPTION_UNIT_TEST_FILE_PATH}}
          
        - name: Build List Unit Test
          working-directory: ${{env.GITHUB_WORKSPACE}}
          run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} /p:Platform=${{env.BUILD_PLATFORM}} /p:PostBuildEventUseInBuild=false ${{env.LIST_UNIT_TEST_FILE_PATH}}
          
        - name: Build Hashmap Unit Test
          working-directory: ${{env.GITHUB_WORKSPACE}}
          run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} /p:Platform=${{env.BUILD_PLATFORM}} /p:PostBuildEventUseInBuild=false ${{env.HASHMAP_UNIT_TEST_FILE_PATH}}
          
        - name: Build Vector Unit Test
          working-directory: ${{env.GITHUB_WORKSPACE}}
          run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} /p:Platform=${{env.BUILD_PLATFORM}} /p:PostBuildEventUseInBuild=false ${{env.VECTOR_UNIT_TEST_FILE_PATH}}
          
        - name: Build Queue Unit Test
          working-directory: ${{env.GITHUB_WORKSPACE}}
          run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} /p:Platform=${{env.BUILD_PLATFORM}} /p:PostBuildEventUseInBuild=false ${{env.QUEUE_UNIT_TEST_FILE_PATH}}
          
        - name: Build Stack Unit Test
          working-directory: ${{env.GITHUB_WORKSPACE}}
          run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} /p:Platform=${{env.BUILD_PLATFORM}} /p:PostBuildEventUseInBuild=false ${{env.STACK_UNIT_TEST_FILE_PATH}}
                 
        - name: Build ECS Unit Test
          working-directory: ${{env.GITHUB_WORKSPACE}}
          run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} /p:Platform=${{env.BUILD_PLATFORM}} /p:PostBuildEventUseInBuild=false ${{env.ECS_UNIT_TEST_FILE_PATH}}
          
        - name: Run Unit Tests
          run: |
            cd scripts
            .\RunUnitTests.bat
            cd ..
          
          